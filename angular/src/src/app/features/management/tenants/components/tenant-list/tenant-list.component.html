<div class="tenant-list-container p-4">
  <!-- Header Section -->
  <div class="header-section d-flex justify-content-between align-items-center mb-4">
    <div class="title-section">
      <h1 class="mb-2">{{ 'tenantManagement.title' | translate }}</h1>
      <p class="subtitle text-muted mb-0">{{ 'tenantManagement.subtitle' | translate }}</p>
    </div>
    
    <div class="actions-section">
      <p-button
        *appHasPermission="['Permission.Tenants.Create']"
        [label]="'tenantManagement.createTenant' | translate"
        icon="pi pi-plus"
        (onClick)="createTenant()">
      </p-button>
    </div>
  </div>

  <!-- Messages -->
  <div class="mb-4">
    @for (message of messages(); track message.content) {
      <p-message
        [severity]="message.severity"
        [closable]="true"
        (onClose)="messages.set([])"
        class="mb-2">
        {{ message.content }}
      </p-message>
    }
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-container p-4">
      <p-skeleton height="2rem" class="mb-3"></p-skeleton>
      <p-skeleton height="2rem" class="mb-3"></p-skeleton>
      <p-skeleton height="2rem" class="mb-3"></p-skeleton>
    </div>
  }

  <!-- Tenants Table -->
  @if (!loading() && tenants().length > 0) {
    <div class="table-container">
    <p-table 
      [value]="tenants()" 
      [paginator]="true" 
      [rows]="10"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="{{ 'tenantManagement.showingResults' | translate }}"
      [globalFilterFields]="['name', 'email', 'firstName', 'lastName']"
      class="p-datatable-sm"
      styleClass="p-datatable-striped">
      
      <ng-template pTemplate="caption">
        <div class="table-header d-flex justify-content-between align-items-center p-3">
          <span class="table-title fw-bold">{{ 'tenantManagement.tenantsList' | translate }}</span>
          <span class="p-input-icon-left">
            <i class="pi pi-search"></i>
            <input 
              pInputText 
              type="text" 
              placeholder="{{ 'tenantManagement.searchTenants' | translate }}"
              (input)="$event.target && $any($event.target).value && $any($event.target).value.length > 0 ? $any($event.target).value : ''"
              #searchInput
              class="form-control">
          </span>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="name">
            {{ 'tenantManagement.name' | translate }}
            <p-sortIcon field="name"></p-sortIcon>
          </th>
          <th pSortableColumn="email">
            {{ 'tenantManagement.email' | translate }}
            <p-sortIcon field="email"></p-sortIcon>
          </th>
          <th pSortableColumn="firstName">
            {{ 'tenantManagement.adminName' | translate }}
            <p-sortIcon field="firstName"></p-sortIcon>
          </th>
          <th pSortableColumn="expirationDate">
            {{ 'tenantManagement.expirationDate' | translate }}
            <p-sortIcon field="expirationDate"></p-sortIcon>
          </th>
          <th pSortableColumn="isActive">
            {{ 'tenantManagement.status' | translate }}
            <p-sortIcon field="isActive"></p-sortIcon>
          </th>
          <th>{{ 'tenantManagement.actions' | translate }}</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-tenant>
        <tr>
          <td>
            <div class="tenant-info">
              <strong>{{ tenant.name }}</strong>
              <small class="text-muted">ID: {{ tenant.identifier }}</small>
            </div>
          </td>
          <td>{{ tenant.email }}</td>
          <td>{{ getTenantAdminFullName(tenant) }}</td>
          <td>
            <span [class]="isTenantExpired(tenant) ? 'text-danger' : ''">
              {{ tenant.expirationDate | date:'short' }}
            </span>
          </td>
          <td>
            <p-tag 
              [value]="getTenantStatusDescription(tenant)"
              [severity]="getStatusSeverity(tenant)">
            </p-tag>
          </td>
          <td>
            <div class="action-buttons d-flex gap-2">
              <p-button
                icon="pi pi-eye"
                [text]="true"
                [rounded]="true"
                size="small"
                (onClick)="viewTenantDetails(tenant)"
                [title]="'tenantManagement.viewDetails' | translate">
              </p-button>
              
              <p-button
                *appHasPermission="['Permission.Tenants.Update']"
                icon="pi pi-pencil"
                [text]="true"
                [rounded]="true"
                size="small"
                (onClick)="editTenant(tenant)"
                [title]="'tenantManagement.editTenant' | translate">
              </p-button>
              
              @if (hasPermission(['Permission.Tenants.Update'])) {
                @if (!tenant.isActive) {
                  <p-button
                    icon="pi pi-check"
                    [text]="true"
                    [rounded]="true"
                    size="small"
                    severity="success"
                    (onClick)="activateTenant(tenant)"
                    [title]="'tenantManagement.activateTenant' | translate">
                  </p-button>
                }
                
                @if (tenant.isActive) {
                  <p-button
                    icon="pi pi-times"
                    [text]="true"
                    [rounded]="true"
                    size="small"
                    severity="warn"
                    (onClick)="deactivateTenant(tenant)"
                    [title]="'tenantManagement.deactivateTenant' | translate">
                  </p-button>
                }
              }
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center">
            <div class="empty-state">
              <i class="pi pi-building" style="font-size: 3rem; color: #ccc;"></i>
              <p>{{ 'tenantManagement.noTenantsFound' | translate }}</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
    </div>
  }

  <!-- Empty State -->
  @if (!loading() && tenants().length === 0) {
    <div class="empty-container">
    <div class="empty-state text-center p-5">
      <i class="pi pi-building mb-4" style="font-size: 4rem; color: #ccc;"></i>
      <h3 class="mb-3">{{ 'tenantManagement.noTenantsYet' | translate }}</h3>
      <p class="text-muted mb-4">{{ 'tenantManagement.getStartedByCreatingTenant' | translate }}</p>
      <p-button
        *appHasPermission="['Permission.Tenants.Create']"
        [label]="'tenantManagement.createFirstTenant' | translate"
        icon="pi pi-plus"
        (onClick)="createTenant()">
      </p-button>
    </div>
    </div>
  }
</div>
