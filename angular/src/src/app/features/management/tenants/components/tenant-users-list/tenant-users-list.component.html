<div class="tenant-users-list-container p-4">
  <!-- Header Section -->
  <div class="header-section d-flex justify-content-between align-items-center mb-4">
    <div class="title-section">
      <h1 class="mb-2">{{ 'userManagement.title' | translate }}</h1>
      <p class="subtitle text-muted mb-0">
        @if (tenant()) {
          <strong>{{ tenant()?.name }}</strong>
        } @else {
          {{ 'userManagement.subtitle' | translate }}
        }
      </p>
    </div>
    
    <div class="actions-section d-flex gap-2">
      <p-button
        [label]="'userManagement.backToTenant' | translate"
        icon="pi pi-arrow-left"
        severity="secondary"
        (onClick)="backToTenantDetails()">
      </p-button>
      
      <p-button
        *appHasPermission="['Permission.CrossTenantUsers.Create']"
        [label]="'userManagement.createUser' | translate"
        icon="pi pi-plus"
        (onClick)="createUser()">
      </p-button>
    </div>
  </div>

  <!-- Messages -->
  <div class="mb-4">
    @for (message of messages(); track message.content) {
      <p-message
        [severity]="message.severity"
        [closable]="true"
        (onClose)="messages.set([])"
        class="mb-2">
        {{ message.content }}
      </p-message>
    }
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-container p-4">
      <p-skeleton height="2rem" class="mb-3"></p-skeleton>
      <p-skeleton height="2rem" class="mb-3"></p-skeleton>
      <p-skeleton height="2rem" class="mb-3"></p-skeleton>
    </div>
  }

  <!-- Users Table -->
  @if (!loading()) {
    <div class="table-container">
    <p-table 
      [value]="users()" 
      [paginator]="true" 
      [rows]="10"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} atÃ© {last} de {totalRecords} resultados"
      [globalFilterFields]="['firstName', 'lastName', 'email', 'userName']"
      styleClass="p-datatable-striped"
      #dt>
      
      <ng-template pTemplate="caption">
        <div class="table-header d-flex justify-content-between align-items-center p-3">
          <span class="table-title fw-bold">{{ 'userManagement.usersList' | translate }}</span>
          <span class="p-input-icon-left">
            <i class="pi pi-search"></i>
            <input 
              pInputText 
              type="text" 
              placeholder="{{ 'userManagement.searchUsers' | translate }}"
              (input)="dt.filterGlobal($any($event.target).value, 'contains')">
          </span>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="firstName">
            {{ 'userManagement.name' | translate }}
            <p-sortIcon field="firstName"></p-sortIcon>
          </th>
          <th>
            {{ 'tenantManagement.tenantName' | translate }}
          </th>
          <th pSortableColumn="email">
            {{ 'userManagement.email' | translate }}
            <p-sortIcon field="email"></p-sortIcon>
          </th>
          <th pSortableColumn="userName">
            {{ 'userManagement.userName' | translate }}
            <p-sortIcon field="userName"></p-sortIcon>
          </th>
          <th pSortableColumn="phoneNumber">
            {{ 'userManagement.phoneNumber' | translate }}
            <p-sortIcon field="phoneNumber"></p-sortIcon>
          </th>
          <th pSortableColumn="isActive">
            {{ 'userManagement.status' | translate }}
            <p-sortIcon field="isActive"></p-sortIcon>
          </th>
          <th>{{ 'userManagement.actions' | translate }}</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-user>
        <tr>
          <td>
            <div class="user-info">
              <strong>{{ getUserFullName(user) }}</strong>
            </div>
          </td>
          <td>
            <div class="tenant-info">
              <strong>{{ tenant()?.name || '-' }}</strong>
              @if (tenant()?.identifier) {
                <small class="text-muted">ID: {{ tenant()?.identifier }}</small>
              }
            </div>
          </td>
          <td>{{ user.email }}</td>
          <td>{{ user.userName }}</td>
          <td>{{ user.phoneNumber || '-' }}</td>
          <td>
            <p-tag [severity]="getUserStatusSeverity(user)">
              {{ getUserStatusDescription(user) | translate }}
            </p-tag>
          </td>
          <td>
            <div class="action-buttons d-flex gap-2">
              <p-button
                icon="pi pi-eye"
                [text]="true"
                [rounded]="true"
                size="small"
                (onClick)="viewUserDetails(user)"
                [title]="'userManagement.viewDetails' | translate">
              </p-button>
              
              <p-button
                *appHasPermission="['Permission.CrossTenantUsers.Update']"
                icon="pi pi-pencil"
                [text]="true"
                [rounded]="true"
                size="small"
                (onClick)="editUser(user)"
                [title]="'userManagement.editUser' | translate">
              </p-button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="text-center">
            <div class="empty-state">
              <i class="pi pi-users" style="font-size: 3rem; color: #ccc;"></i>
              <p>{{ 'userManagement.noUsersFound' | translate }}</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
    </div>
  }
</div>

